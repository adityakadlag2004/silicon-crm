
{% extends "base.html" %}
{% block title %}Calling Workspace{% endblock %}

{% block content %}
<style>
  .workspace-card {
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.06);
    padding: 2.2rem 1.5rem 2rem 1.5rem;
    margin-bottom: 1.2rem;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
  }
  .workspace-card h2 {
    text-align: center;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 1.2rem;
    letter-spacing: 0.5px;
  }
  .workspace-table {
    width: 100%;
    border-radius: 10px;
    overflow: hidden;
    background: #f7fafc;
    box-shadow: 0 1px 4px rgba(0,0,0,0.04);
    margin-bottom: 0;
  }
  .workspace-table th {
    background: linear-gradient(90deg, #f6e05e 0%, #ecc94b 100%);
    color: #2d3748;
    font-weight: 600;
    text-align: center;
    padding: 0.7rem 0.3rem;
    border-bottom: 1px solid #e2e8f0;
  }
  .workspace-table td {
    text-align: center;
    padding: 0.7rem 0.3rem;
    border-bottom: 1px solid #e2e8f0;
    background: #fff;
    font-size: 1rem;
  }
  .workspace-table tr:last-child td {
    border-bottom: none;
  }
  .workspace-actions button {
    margin: 0 0.15rem;
    min-width: 90px;
    font-size: 0.97rem;
    border-radius: 8px;
    font-weight: 500;
  }
  .modal-content {
    border-radius: 14px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
  }
  @media (max-width: 900px) {
    .workspace-card { padding: 1rem 0.2rem; max-width: 99vw; }
    .workspace-table th, .workspace-table td { font-size: 0.95rem; padding: 0.5rem 0.1rem; }
    .workspace-actions button { min-width: 70px; font-size: 0.93rem; }
  }
  @media (max-width: 600px) {
    .workspace-card { padding: 0.5rem 0.1rem; }
    .workspace-table th, .workspace-table td { font-size: 0.9rem; padding: 0.35rem 0.05rem; }
    .workspace-actions button { min-width: 60px; font-size: 0.9rem; }
  }
</style>
<div class="workspace-card">
  <h2>{{ calling_list.title }}</h2>
  <div class="d-flex mb-3">
    <div class="me-auto"></div>
    <div>
      <form method="get" class="d-flex">
        <label class="me-2">Per page</label>
        <select name="per_page" class="form-select form-select-sm" onchange="this.form.submit()">
          <option value="10" {% if per_page|default:25 == 10 %}selected{% endif %}>10</option>
          <option value="25" {% if per_page|default:25 == 25 %}selected{% endif %}>25</option>
          <option value="50" {% if per_page|default:25 == 50 %}selected{% endif %}>50</option>
          <option value="100" {% if per_page|default:25 == 100 %}selected{% endif %}>100</option>
        </select>
      </form>
    </div>
  </div>

  <div style="max-height:60vh; overflow:auto;" class="workspace-table">
  <table class="table mb-0">
    <thead>
      <tr>
        <th>Prospect</th>
        <th>Phone</th>
        <th>Status</th>
        <th>Last Call</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for prospect in page_obj.object_list %}
      <tr>
        <td>{{ prospect.name }}</td>
        <td>{{ prospect.phone }}</td>
        <td>{{ prospect.get_status_display }}</td>
        <td>{{ prospect.last_contacted|date:"Y-m-d H:i"|default:"-" }}</td>
        <td class="workspace-actions">
          <button class="btn btn-sm btn-success" onclick="alert('Dialing {{ prospect.phone }}...')">Call</button>
          <button class="btn btn-sm btn-warning" data-bs-toggle="modal" data-bs-target="#logResultModal{{ prospect.id }}">Log Result</button>
          <button class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#followUpModal{{ prospect.id }}">Add Follow-up</button>
        </td>
      </tr>
      <!-- Log Result Modal -->
      <div class="modal fade" id="logResultModal{{ prospect.id }}" tabindex="-1">
        <div class="modal-dialog">
          <form method="post" action="{% url 'clients:log_result' prospect.id %}">
            {% csrf_token %}
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Log Call Result – {{ prospect.name }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label class="form-label">Call Status</label>
                  <select name="status" class="form-select" required>
                    <option value="called">Called</option>
                    <option value="no_answer">No Answer</option>
                    <option value="interested">Interested</option>
                    <option value="not_interested">Not Interested</option>
                    <option value="busy">Busy</option>
                    <option value="wrong_number">Wrong Number</option>
                    <option value="follow_up">Follow-up</option>
                  </select>
                </div>
                <div class="mb-3">
                  <label class="form-label">Notes</label>
                  <textarea name="notes" class="form-control"></textarea>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Save</button>
              </div>
            </div>
          </form>
        </div>
      </div>
      <!-- Follow-up Modal -->
      <div class="modal fade" id="followUpModal{{ prospect.id }}" tabindex="-1">
        <div class="modal-dialog">
          <form method="post" action="{% url 'clients:add_followup' prospect.id %}">
            {% csrf_token %}
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title">Add Follow-up – {{ prospect.name }}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>
              <div class="modal-body">
                <div class="mb-3">
                  <label class="form-label">Follow-up Date & Time</label>
                  <input type="datetime-local" name="scheduled_time" class="form-control" required>
                </div>
                <div class="mb-3">
                  <label class="form-label">Notes</label>
                  <textarea name="notes" class="form-control"></textarea>
                </div>
              </div>
              <div class="modal-footer">
                <button type="submit" class="btn btn-primary">Add Follow-up</button>
              </div>
            </div>
          </form>
        </div>
      </div>
      {% endfor %}
    </tbody>
  </table>
  </div>

  <nav aria-label="Page navigation" class="mt-3">
    <ul class="pagination justify-content-center">
      {% if page_obj.has_previous %}
        <li class="page-item"><a class="page-link" href="?page=1&per_page={{ per_page }}{% if qs_params %}&{{ qs_params }}{% endif %}">« First</a></li>
        <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}&per_page={{ per_page }}{% if qs_params %}&{{ qs_params }}{% endif %}">‹ Prev</a></li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">« First</span></li>
        <li class="page-item disabled"><span class="page-link">‹ Prev</span></li>
      {% endif %}

      {% for p in page_obj.paginator.page_range %}
        {% if p >= page_obj.number|add:-2 and p <= page_obj.number|add:2 %}
          {% if p == page_obj.number %}
            <li class="page-item active"><span class="page-link">{{ p }}</span></li>
          {% else %}
            <li class="page-item"><a class="page-link" href="?page={{ p }}&per_page={{ per_page }}{% if qs_params %}&{{ qs_params }}{% endif %}">{{ p }}</a></li>
          {% endif %}
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
  <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}&per_page={{ per_page }}{% if qs_params %}&{{ qs_params }}{% endif %}">Next ›</a></li>
  <li class="page-item"><a class="page-link" href="?page={{ page_obj.paginator.num_pages }}&per_page={{ per_page }}{% if qs_params %}&{{ qs_params }}{% endif %}">Last »</a></li>
      {% else %}
  <li class="page-item disabled"><span class="page-link">Next ›</span></li>
  <li class="page-item disabled"><span class="page-link">Last »</span></li>
      {% endif %}
    </ul>
  </nav>
</div>
{% endblock %}
