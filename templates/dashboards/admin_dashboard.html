{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<style>
  .dashboard-section-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #2d3748;
    margin-bottom: 1.5rem;
    margin-top: 2rem;
    letter-spacing: 0.5px;
  }
  .dashboard-cards-row {
    display: flex;
    gap: 1.2rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
  }
  .dashboard-card {
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    padding: 1.1rem 1rem;
    min-width: 180px;
    flex: 1 1 0;
    text-align: center;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    transition: box-shadow 0.2s;
  }
  .dashboard-card:hover {
    box-shadow: 0 4px 24px rgba(0,0,0,0.12);
  }
  .dashboard-card h5 {
    font-size: 1.15rem;
    font-weight: 600;
    margin-bottom: 0.3rem;
    color: #4a5568;
  }
  .dashboard-card h3 {
    font-size: 1.6rem;
    font-weight: 700;
    margin: 0;
    color: #2b6cb0;
  }
  .dashboard-products-row {
    display: flex;
    gap: 1.2rem;
    margin-bottom: 1.5rem;
    flex-wrap: wrap;
    justify-content: stretch;
    width: 100%;
  }
  .dashboard-product-card {
    background: #f7fafc;
    border-radius: 12px;
    box-shadow: 0 1px 6px rgba(0,0,0,0.05);
    padding: 1.5rem 2.2rem;
    margin: 0.5rem 0.5rem 0.8rem 0.5rem;
    min-width: 180px;
    flex: 1 1 0;
    text-align: center;
    font-size: 1.12rem;
    width: 100%;
    max-width: none;
  }
  .dashboard-product-card h6 {
    font-size: 0.98rem;
    font-weight: 600;
    color: #4a5568;
    margin-bottom: 0.2rem;
  }
  .dashboard-product-card h5 {
    font-size: 1.15rem;
    font-weight: 700;
    color: #2b6cb0;
    margin: 0;
  }
  .dashboard-link {
    display: inline-flex;
    align-items: center;
    padding: 0.7rem 1.5rem;
    border-radius: 12px;
    background: linear-gradient(90deg, #f6e05e 0%, #ecc94b 100%);
    color: #2d3748;
    font-weight: 600;
    text-decoration: none;
    box-shadow: 0 1px 6px rgba(0,0,0,0.07);
    transition: background 0.2s;
  }
  .dashboard-link:hover {
    background: linear-gradient(90deg, #ecc94b 0%, #f6e05e 100%);
    color: #1a202c;
  }
  
  .modern-table {
    width: 100%;
    border-collapse: separate;
    border-spacing: 0;
    font-size: 1.08rem;
    background: #fff;
    border-radius: 12px;
    box-shadow: 0 1px 8px rgba(0,0,0,0.05);
    overflow: hidden;
  }
  .modern-table th {
    background: linear-gradient(90deg,#f6e05e 0%,#ecc94b 100%);
    color: #2d3748;
    font-weight: 700;
    padding: 0.85rem 0.5rem;
    border-bottom: 2px solid #e2e8f0;
    font-size: 1.08rem;
  }
  .modern-table td {
    padding: 0.7rem 0.5rem;
    border-bottom: 1px solid #e2e8f0;
    font-size: 1.05rem;
    color: #2d3748;
  }
  .modern-table tr:last-child td {
    border-bottom: none;
  }
  .modern-table tbody tr:hover {
    background: #f7fafc;
    transition: background 0.2s;
  }
  @media (max-width: 900px) {
    .dashboard-cards-row, .dashboard-products-row { flex-direction: column; gap: 0.7rem; }
    .dashboard-card, .dashboard-product-card { min-width: 0; }
    .modern-table th, .modern-table td { font-size: 0.98rem; }
    .table-bordered th, .table-bordered td { font-size: 0.98rem; }
  }
  @media (max-width: 600px) {
    .dashboard-section-title { font-size: 1.05rem; text-align: center; }
    .dashboard-card, .dashboard-product-card { padding: 0.7rem 0.2rem; font-size: 0.92rem; text-align: center; }
    .modern-table th, .modern-table td { font-size: 0.93rem; padding: 0.5rem 0.2rem; text-align: center; }
    .table-bordered th, .table-bordered td { font-size: 0.93rem; padding: 0.5rem 0.2rem; text-align: center; }
    h4 { font-size: 1rem; text-align: center; }
    .dashboard-cards-row, .dashboard-products-row, .table-responsive { justify-content: center; }
    body, .container, .row { text-align: center; }
    .dashboard-products-row { display: flex; flex-wrap: wrap; justify-content: center; gap: 1rem; }
    .dashboard-product-card { margin-left: auto; margin-right: auto; }
  }
</style>

<div class="dashboard-section-title">Admin Dashboard</div>

<div class="card mb-3" style="border-radius:12px;box-shadow:0 1px 8px rgba(0,0,0,0.06);">
  <div class="card-header" style="background:linear-gradient(90deg,#f6e05e 0%,#ecc94b 100%);color:#2d3748;display:flex;align-items:center;justify-content:space-between;">
    <span><strong>Notifications</strong></span>
    {% if unread_notifications %}
      <span class="badge bg-danger">{{ unread_notifications }} new</span>
    {% else %}
      <span class="badge bg-secondary">All caught up</span>
    {% endif %}
  </div>
  <ul class="list-group list-group-flush">
    {% if notifications %}
      {% for note in notifications %}
        <li class="list-group-item" style="display:flex;flex-direction:column;align-items:flex-start;gap:0.2rem;">
          <div style="font-weight:600;">{{ note.title }}</div>
          <div style="font-size:0.95rem;color:#4a5568;">{{ note.body }}</div>
          <div style="font-size:0.82rem;color:#718096;">{{ note.created_at|date:"M d, h:i A" }}</div>
          {% if note.link %}
            <a href="{{ note.link }}" class="dashboard-link" style="padding:0.35rem 0.75rem;font-size:0.9rem;">Open</a>
          {% endif %}
        </li>
      {% endfor %}
    {% else %}
      <li class="list-group-item" style="font-size:0.95rem;color:#4a5568;">No notifications yet.</li>
    {% endif %}
  </ul>
</div>

<div class="dashboard-cards-row" style="display:flex;flex-wrap:wrap;gap:1rem;">
  <div class="dashboard-card" style="flex:1 1 180px;min-width:120px;">
    <h5>Total Clients</h5>
    <h3>{{ total_clients }}</h3>
  </div>
  <div class="dashboard-card" style="flex:1 1 180px;min-width:120px;">
    <h5>Total Sales (This Month)</h5>
    <h3>â‚¹{{ total_sales }}</h3>
  </div>
  <div class="dashboard-card" style="flex:1 1 180px;min-width:120px;">
    <h5>Total Points (This Month)</h5>
    <h3 id="points-counter" data-points="{{ total_points }}">0</h3>
  </div>
</div>

<div class="dashboard-section-title">Product-wise Sales (This Month)</div>
<div class="dashboard-products-row" style="display:flex;flex-wrap:wrap;gap:1.2rem;width:100%;">
  <div class="dashboard-product-card" style="flex:1 1 120px;min-width:90px;max-width:180px;">
    <h6>SIP</h6>
    <h5>â‚¹{{ sip_sales }}</h5>
  </div>
  <div class="dashboard-product-card" style="flex:1 1 120px;min-width:90px;max-width:180px;">
    <h6>Lumpsum</h6>
    <h5>â‚¹{{ lumsum_sales }}</h5>
  </div>
  <div class="dashboard-product-card" style="flex:1 1 120px;min-width:90px;max-width:180px;">
    <h6>Life Insurance</h6>
    <h5>â‚¹{{ life_sales }}</h5>
  </div>
  <div class="dashboard-product-card" style="flex:1 1 120px;min-width:90px;max-width:180px;">
    <h6>Health Insurance</h6>
    <h5>â‚¹{{ health_sales }}</h5>
  </div>
  <div class="dashboard-product-card" style="flex:1 1 120px;min-width:90px;max-width:180px;">
    <h6>Motor Insurance</h6>
    <h5>â‚¹{{ motor_sales }}</h5>
  </div>
  <div class="dashboard-product-card" style="flex:1 1 120px;min-width:90px;max-width:180px;">
    <h6>PMS</h6>
    <h5>â‚¹{{ pms_sales }}</h5>
  </div>
</div>

<hr class="my-4" />

<!-- ================== Section 1: Todayâ€™s Summary ================== -->
<h4>Today's Summary (Per Employee)</h4>
<div class="table-responsive mb-5" style="overflow-x:auto;">
  {% for row in todays_summary %}
    <div class="card mb-2" style="border-radius:10px;box-shadow:0 1px 6px rgba(0,0,0,0.05);">
      <div class="card-header" style="background:linear-gradient(90deg,#f6e05e 0%,#ecc94b 100%);color:#2d3748;cursor:pointer;" data-bs-toggle="collapse" data-bs-target="#today-{{ forloop.counter }}" aria-expanded="false" aria-controls="today-{{ forloop.counter }}">
        <strong>{{ row.employee }}</strong>
      </div>
      <div id="today-{{ forloop.counter }}" class="collapse">
        <div class="card-body p-2">
          <table class="table table-bordered text-center mb-0">
            <thead class="table-light">
              <tr>
                <th>Sales (â‚¹)</th>
                <th>Points</th>
                <th>New Clients</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>â‚¹{{ row.sales }}</td>
                <td>{{ row.points }}</td>
                <td>{{ row.new_clients }}</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% empty %}
    <div class="card mb-2"><div class="card-body">No data for today</div></div>
  {% endfor %}
</div>
<hr class="my-4" />
<!-- ================== Section 2: Monthly Sales Progress ================== -->
<h4>Monthly Sales Progress (Employee Ã— Product)</h4>
<div class="table-responsive mb-5" style="overflow-x:auto;">
  {% for row in monthly_progress %}
    <div class="card mb-2" style="border-radius:10px;box-shadow:0 1px 6px rgba(0,0,0,0.05);">
      <div class="card-header" style="background:linear-gradient(90deg,#f6e05e 0%,#ecc94b 100%);color:#2d3748;cursor:pointer;" data-bs-toggle="collapse" data-bs-target="#employee-{{ forloop.counter }}" aria-expanded="false" aria-controls="employee-{{ forloop.counter }}">
        <strong>{{ row.employee }}</strong>
      </div>
      <div id="employee-{{ forloop.counter }}" class="collapse">
        <div class="card-body p-2">
          <table class="table table-bordered text-center mb-0">
            <thead class="table-light">
              <tr>
                <th>SIP (â‚¹)</th>
                <th>Lumpsum (â‚¹)</th>
                <th>Life Insurance (â‚¹)</th>
                <th>Health Insurance (â‚¹)</th>
                <th>Motor Insurance (â‚¹)</th>
                <th>PMS (â‚¹)</th>
                <th>Total (â‚¹)</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>â‚¹{{ row.sip }}</td>
                <td>â‚¹{{ row.lumpsum }}</td>
                <td>â‚¹{{ row.life }}</td>
                <td>â‚¹{{ row.health }}</td>
                <td>â‚¹{{ row.motor }}</td>
                <td>â‚¹{{ row.pms }}</td>
                <td><strong>â‚¹{{ row.total }}</strong></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  {% empty %}
    <div class="card mb-2"><div class="card-body">No data available for this month</div></div>
  {% endfor %}
</div>
<hr class="my-4" />
<!-- ================== Section 3: Monthly Cumulative Summary ================== -->
<!-- Insert into your admin dashboard template where links/cards are shown -->
<!-- ADMIN PAST PERFORMANCE SECTION -->
<!-- Admin past performance - plain style -->
<div style="border-top:1px solid #e6eef2; padding-top:2rem;">
  <h2 style="font-size:2rem; font-weight:700; color:#2d3748; margin:0 0 1rem 0;">
    Admin Past Performance (Cumulative)
  </h2>

  <div class="mt-3">
    <!-- plain link (browser default) -->
    <a href="{% url 'clients:admin_past_performance' %}" class="dashboard-link">View Detailed Past Performance</a>
  </div>
  
</div>
<hr class="my-4" />


<!-- ðŸ”¹ Points Counter Animation -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const counter = document.getElementById("points-counter");
    if (counter) {
      const target = parseFloat(counter.getAttribute("data-points")) || 0;
      let current = 0;
      const step = target / 50; // speed: 50 frames
      function animate() {
        current += step;
        if (current >= target) {
          counter.innerText = Math.round(target);
        } else {
          counter.innerText = Math.round(current);
          requestAnimationFrame(animate);
        }
      }
      animate();
    }
  });
</script>
{% endblock %}
