{% extends "base.html" %}

{% block title %}Admin Dashboard{% endblock %}

{% block content %}
<h2 class="mb-4">Admin Dashboard</h2>

<div class="row">
  <!-- Total Clients -->
  <div class="col-md-3 mb-3">
    <div class="card text-center p-3">
      <h5>Total Clients</h5>
      <h3 class="text-primary">{{ total_clients }}</h3>
    </div>
  </div>

  <!-- Total Sales (All Products) -->
  <div class="col-md-3 mb-3">
    <div class="card text-center p-3">
      <h5>Total Sales (This Month)</h5>
      <h3 class="text-success">â‚¹{{ total_sales }}</h3>
    </div>
  </div>

  <!-- Total Points -->
  <div class="col-md-3 mb-3">
    <div class="card text-center p-3">
      <h5>Total Points (This Month)</h5>
      <h3
        class="text-danger"
        id="points-counter"
        data-points="{{ total_points }}"
      >
        0
      </h3>
    </div>
  </div>
</div>

<!-- ðŸ”¹ Product-wise Sales Amounts -->
<hr class="my-4" />
<h4>Product-wise Sales (This Month)</h4>
<div class="row">
  <div class="col-md-2 mb-3">
    <div class="card text-center p-3">
      <h6>SIP</h6>
      <h5>â‚¹{{ sip_sales }}</h5>
    </div>
  </div>
  <div class="col-md-2 mb-3">
    <div class="card text-center p-3">
      <h6>Lumpsum</h6>
      <h5>â‚¹{{ lumsum_sales }}</h5>
    </div>
  </div>
  <div class="col-md-2 mb-3">
    <div class="card text-center p-3">
      <h6>Life Insurance</h6>
      <h5>â‚¹{{ life_sales }}</h5>
    </div>
  </div>
  <div class="col-md-2 mb-3">
    <div class="card text-center p-3">
      <h6>Health Insurance</h6>
      <h5>â‚¹{{ health_sales }}</h5>
    </div>
  </div>
  <div class="col-md-2 mb-3">
    <div class="card text-center p-3">
      <h6>Motor Insurance</h6>
      <h5>â‚¹{{ motor_sales }}</h5>
    </div>
  </div>
  <div class="col-md-2 mb-3">
    <div class="card text-center p-3">
      <h6>PMS</h6>
      <h5>â‚¹{{ pms_sales }}</h5>
    </div>
  </div>
</div>

<hr class="my-4" />

<!-- ================== Section 1: Todayâ€™s Summary ================== -->
<h4>Today's Summary (Per Employee)</h4>
<div class="table-responsive mb-5">
  <table class="table table-bordered text-center">
    <thead class="table-light">
      <tr>
        <th>Employee</th>
        <th>Sales (â‚¹)</th>
        <th>Points</th>
        <th>New Clients</th>
      </tr>
    </thead>
    <tbody>
      {% for row in todays_summary %}
      <tr>
        <td>{{ row.employee }}</td>
        <td>â‚¹{{ row.sales }}</td>
        <td>{{ row.points }}</td>
        <td>{{ row.new_clients }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="4">No data for today</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<hr class="my-4" />
<!-- ================== Section 2: Monthly Sales Progress ================== -->
<h4>Monthly Sales Progress (Employee Ã— Product)</h4>
<div class="table-responsive mb-5">
  <table class="table table-bordered text-center">
    <thead class="table-light">
      <tr>
        <th>Employee</th>
        <th>SIP (â‚¹)</th>
        <th>Lumpsum (â‚¹)</th>
        <th>Life Insurance (â‚¹)</th>
        <th>Health Insurance (â‚¹)</th>
        <th>Motor Insurance (â‚¹)</th>
        <th>PMS (â‚¹)</th>
        <th>Total (â‚¹)</th>
      </tr>
    </thead>
    <tbody>
      {% for row in monthly_progress %}
      <tr>
        <td>{{ row.employee }}</td>
        <td>â‚¹{{ row.sip }}</td>
        <td>â‚¹{{ row.lumpsum }}</td>
        <td>â‚¹{{ row.life }}</td>
        <td>â‚¹{{ row.health }}</td>
        <td>â‚¹{{ row.motor }}</td>
        <td>â‚¹{{ row.pms }}</td>
        <td><strong>â‚¹{{ row.total }}</strong></td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="8">No data available for this month</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<hr class="my-4" />
<!-- ================== Section 3: Monthly Cumulative Summary ================== -->
<!-- ðŸ”¹ Points Counter Animation -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const counter = document.getElementById("points-counter");
    if (counter) {
      const target = parseFloat(counter.getAttribute("data-points")) || 0;
      let current = 0;
      const step = target / 50; // speed: 50 frames
      function animate() {
        current += step;
        if (current >= target) {
          counter.innerText = Math.round(target);
        } else {
          counter.innerText = Math.round(current);
          requestAnimationFrame(animate);
        }
      }
      animate();
    }
  });
</script>
{% endblock %}
