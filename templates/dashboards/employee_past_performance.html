{% extends "base.html" %}
{% load static %}

{% block title %}Past Performance{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto p-6 space-y-8">
  
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold text-gray-900">Past Performance</h1>
      <p class="text-sm text-gray-500">Track your monthly points and performance history</p>
    </div>
    <a href="{% url 'clients:employee_dashboard' %}" 
       class="inline-flex items-center px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white font-medium shadow transition">
      Back to Dashboard
    </a>
  </div>

  <!-- Main Content -->
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    
    <!-- Chart Card -->
    <div class="lg:col-span-2 bg-white rounded-xl shadow p-5">
      <h3 class="text-lg font-semibold text-gray-800 mb-4">Monthly Points (Last 12 months)</h3>
      <div class="h-64">
        <canvas id="pointsChart"></canvas>
      </div>
      <p class="mt-3 text-xs text-gray-500">Line chart showing total points earned each month.</p>
    </div>

    <!-- Months List -->
    <div class="bg-white rounded-xl shadow p-5">
      <h3 class="text-lg font-semibold text-gray-800 mb-3">Monthly Records</h3>
<ul class="text-sm text-gray-800">
  {% for m in months_data %}
  <li class="flex items-center justify-between">
    <span>{{ m.label }}</span>
    <div class="flex items-center space-x-3">
      <span class="text-xs text-gray-500">{{ m.points }} pts</span>
      <a href="{% url 'clients:past_month_performance' year=m.year month=m.month %}" 
         class="text-xs text-yellow-600 hover:text-yellow-700 underline">
        View
      </a>
    </div>
  </li>
  {% empty %}
  <li class="text-gray-500">No records available.</li>
  {% endfor %}
</ul>
</div>
  </div>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const labels = JSON.parse('{{ labels_json|escapejs }}');
  const points = JSON.parse('{{ points_json|escapejs }}');

  const ctx = document.getElementById('pointsChart').getContext('2d');
  const gradient = ctx.createLinearGradient(0, 0, 0, 250);
  gradient.addColorStop(0, 'rgba(255,214,0,0.25)'); // yellow
  gradient.addColorStop(1, 'rgba(255,214,0,0)');

  new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [{
        label: 'Points',
        data: points,
        fill: true,
        backgroundColor: gradient,
        borderColor: '#E53935', // Kadlag red
        tension: 0.35,
        pointBackgroundColor: '#FFD600', // Kadlag yellow
        pointBorderColor: '#E53935',
        pointRadius: 4,
        pointHoverRadius: 6,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      scales: {
        y: {
          beginAtZero: true,
          grace: '10%',
          ticks: {
            callback: function(value) {
              if (value >= 1000000) return (value/1000000) + "M";
              if (value >= 1000) return (value/1000) + "K";
              return value;
            }
          },
          grid: { color: 'rgba(0,0,0,0.05)' }
        },
        x: {
          grid: { display: false }
        }
      },
      plugins: {
        legend: { display: false },
        tooltip: {
          mode: 'index',
          intersect: false,
          backgroundColor: '#E53935',
          titleColor: '#fff',
          bodyColor: '#fff',
          borderColor: '#FFD600',
          borderWidth: 1,
        }
      }
    }
  });
</script>
{% endblock %}