{% extends "base.html" %}
{% block title %}Edit Client — {{ client.name }}{% endblock %}

{% block content %}
<style>
  .modern-card {
    background: #fff;
    border-radius: 14px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.06);
    padding: 1.6rem;
    margin: 1.5rem auto;
    max-width: 1100px;
  }
  .section {
    border-radius: 10px;
    padding: 0.9rem;
    margin-bottom: 1rem;
    background: linear-gradient(180deg, #ffffff 0%, #f7fafc 100%);
    box-shadow: inset 0 1px 0 rgba(255,255,255,0.6);
  }
  .section h4 {
    margin: 0 0 0.6rem 0;
    font-size: 1rem;
    font-weight: 700;
    color: #2d3748;
  }
  .form-label { font-weight: 600; color: #4a5568; margin-bottom: 0.25rem; display:block; }
  .form-control, select {
    border-radius: 8px;
    border: 1px solid #e2e8f0;
    padding: 0.6rem 0.8rem;
    background: #fff;
    font-size: 0.95rem;
    color: #2d3748;
    width: 100%;
    box-sizing: border-box;
  }
  .row-gap { display:grid; grid-template-columns: repeat(3,1fr); gap: 0.9rem; }
  .row-gap-2 { display:grid; grid-template-columns: repeat(2,1fr); gap: 0.9rem; }
  .full-row { width: 100%; }
  .muted { color:#718096; font-size:0.9rem; margin-top:0.25rem; display:block; }
  .btn-save { background: linear-gradient(90deg,#f6e05e 0%,#ecc94b 100%); color:#1a202c; border:none; padding:0.6rem 1rem; border-radius:8px; font-weight:700; }
  .btn-cancel { background:#e2e8f0; color:#2d3748; border:none; padding:0.55rem 0.9rem; border-radius:8px; font-weight:700; }
  @media (max-width:900px) {
    .row-gap, .row-gap-2 { grid-template-columns: 1fr; }
  }
</style>

<div class="modern-card">
  <h2>Edit Client — {{ client.name }}</h2>
  {% if messages %}
    {% for m in messages %}
      <div class="alert alert-{{ m.tags }}">{{ m }}</div>
    {% endfor %}
  {% endif %}

  <form method="post">
    {% csrf_token %}

    <!-- General -->
    <div class="section">
      <h4>General</h4>
      <div class="row-gap-2">
        <div>
          <label class="form-label">Name</label>
          {{ form.name }}
        </div>
        <div>
          <label class="form-label">Email</label>
          {{ form.email }}
        </div>
      </div>

      <div class="row-gap">
        <div>
          <label class="form-label">Phone</label>
          {{ form.phone }}
        </div>
        <div>
          <label class="form-label">PAN</label>
          {{ form.pan }}
        </div>
        <div>
          <label class="form-label">Mapped To</label>
          {% if request.user.employee and request.user.employee.role == 'admin' %}
            {{ form.mapped_to }}
          {% else %}
            {% if client.mapped_to %}
              <input class="form-control" type="text" value="{{ client.mapped_to.user.username }}" disabled>
            {% else %}
              <input class="form-control" type="text" value="-" disabled>
            {% endif %}
            <small class="muted">You cannot change mapping</small>
          {% endif %}
        </div>
      </div>

      <div>
        <label class="form-label">Address</label>
        {{ form.address }}
      </div>
    </div>

    <!-- SIP -->
    <div class="section">
      <h4>SIP</h4>
      <div class="row-gap">
        <div><label class="form-label">SIP Status</label>{{ form.sip_status }}</div>
        <div><label class="form-label">SIP Amount (₹)</label>{{ form.sip_amount }}</div>
        <div><label class="form-label">SIP Top-up (₹)</label>{{ form.sip_topup }}</div>
      </div>
    </div>

    <!-- Life Insurance -->
    <div class="section">
      <h4>Life Insurance</h4>
      <div class="row-gap">
        <div><label class="form-label">Life Status</label>{{ form.life_status }}</div>
        <div><label class="form-label">Life Cover (₹)</label>{{ form.life_cover }}</div>
        <div><label class="form-label">Life Product</label>{{ form.life_product }}</div>
      </div>
    </div>

    <!-- Health Insurance -->
    <div class="section">
      <h4>Health Insurance</h4>
      <div class="row-gap">
        <div><label class="form-label">Health Status</label>{{ form.health_status }}</div>
        <div><label class="form-label">Health Cover (₹)</label>{{ form.health_cover }}</div>
        <div><label class="form-label">Health Top-up (₹)</label>{{ form.health_topup }}</div>
        <div style="grid-column:1/-1;"><label class="form-label">Health Product</label>{{ form.health_product }}</div>
      </div>
    </div>

    <!-- Motor Insurance -->
    <div class="section">
      <h4>Motor Insurance</h4>
      <div class="row-gap">
        <div><label class="form-label">Motor Status</label>{{ form.motor_status }}</div>
        <div><label class="form-label">Insured Value (₹)</label>{{ form.motor_insured_value }}</div>
        <div><label class="form-label">Motor Product</label>{{ form.motor_product }}</div>
      </div>
    </div>

    <!-- PMS -->
    <div class="section">
      <h4>PMS</h4>
      <div class="row-gap">
        <div><label class="form-label">PMS Status</label>{{ form.pms_status }}</div>
        <div><label class="form-label">PMS Amount (₹)</label>{{ form.pms_amount }}</div>
        <div><label class="form-label">PMS Start Date</label>{{ form.pms_start_date }}</div>
      </div>
    </div>

    <div style="display:flex;justify-content:flex-end;gap:0.5rem;">
      <button type="submit" class="btn-save">Save Changes</button>
      <a href="{% if request.user.employee and request.user.employee.role == 'admin' %}{% url 'clients:all_clients' %}{% else %}{% url 'clients:my_clients' %}{% endif %}" class="btn-cancel">Cancel</a>
    </div>
  </form>
</div>
{% endblock %}
